{% extends "base.html" %}

{% block title %}èˆˆè¡Œåå…¥ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹{% endblock %}

{% block content %}

<h2>ğŸ¬ èˆˆè¡Œåå…¥ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹</h2>

<!-- æ¤œç´¢ãƒ•ã‚©ãƒ¼ãƒ  -->
<form method="get" style="margin-bottom: 20px;">
    å¹´: <input type="text" name="year" value="{{ request.args.get('year', '') }}">
    ã‚¿ã‚¤ãƒˆãƒ«: <input type="text" name="title" value="{{ request.args.get('title', '') }}">
    é…çµ¦ä¼šç¤¾: <input type="text" name="distributor" value="{{ request.args.get('distributor', '') }}">
    <br><br>
    èˆˆåï¼ˆå„„å††ï¼‰: <input type="text" name="min_revenue" placeholder="æœ€å°" value="{{ request.args.get('min_revenue', '') }}">
    ï½ <input type="text" name="max_revenue" placeholder="æœ€å¤§" value="{{ request.args.get('max_revenue', '') }}">
    <br><br>
    ç›£ç£å: <input type="text" name="director" value="{{ request.args.get('director', '') }}">
    ã‚­ãƒ£ã‚¹ãƒˆå: <input type="text" name="actor" value="{{ request.args.get('actor', '') }}">
    <input type="submit" value="æ¤œç´¢" class="button">
</form>

<!-- ğŸ” ã‚«ãƒ¼ãƒ‰è¡¨ç¤ºã¸ã®åˆ‡ã‚Šæ›¿ãˆãƒªãƒ³ã‚¯ -->
<div style="margin-bottom: 10px;">
    <a href="{{ url_for('search',
        year=request.args.get('year'),
        title=request.args.get('title'),
        distributor=request.args.get('distributor'),
        min_revenue=request.args.get('min_revenue'),
        max_revenue=request.args.get('max_revenue'),
        director=request.args.get('director'),
        actor=request.args.get('actor'),
        order_by=order_by,
        sort=sort) }}"
       style="padding: 6px 12px; background-color: #f5f5f5; border-radius: 6px; color: #333; text-decoration: none; border: 1px solid #ccc;">
       ğŸ–¼ ã‚«ãƒ¼ãƒ‰è¡¨ç¤ºã«åˆ‡ã‚Šæ›¿ãˆ
    </a>
</div>

<!-- ä¸¦ã³æ›¿ãˆ -->
<table style="width: 100%; border-collapse: collapse; background-color: white; box-shadow: 0 2px 5px rgba(0,0,0,0.1);">
    <thead>
        <tr style="background-color: #f0f0f0;">
            {% set sort_icon = {'asc': 'â–²', 'desc': 'â–¼'} %}
            {% set next_sort = 'asc' if sort == 'desc' else 'desc' %}

            {% macro sort_link(column, label) %}
            <th style="padding: 10px; border: 1px solid #ccc;">
                <a href="{{ url_for('table_view',
                    year=request.args.get('year'),
                    title=request.args.get('title'),
                    distributor=request.args.get('distributor'),
                    min_revenue=request.args.get('min_revenue'),
                    max_revenue=request.args.get('max_revenue'),
                    director=request.args.get('director'),
                    actor=request.args.get('actor'),
                    order_by=column,
                    sort=(next_sort if order_by == column else 'asc')) }}">
                    {{ label }}{% if order_by == column %}{{ sort_icon[sort] }}{% endif %}
                </a>
            </th>
            {% endmacro %}

            {{ sort_link('year', 'å¹´') }}
            {{ sort_link('release_date', 'å…¬é–‹æ—¥') }}
            {{ sort_link('title', 'ä½œå“å') }}
            {{ sort_link('revenue', 'èˆˆå(å„„å††)') }}
            {{ sort_link('category', 'åŒºåˆ†') }}
            {{ sort_link('distributor', 'é…çµ¦ä¼šç¤¾') }}
        </tr>
    </thead>
    <tbody>
        {% for m in movies %}
        <tr>
            <td style="padding: 10px; border: 1px solid #ccc;">{{ m.year }}</td>
            <td style="padding: 10px; border: 1px solid #ccc;">{{ m.release_date }}</td>
            <td style="padding: 10px; border: 1px solid #ccc;">
                <a href="{{ url_for('movie_detail', movie_id=m.id) }}">{{ m.title }}</a>
            </td>
            <td style="padding: 10px; border: 1px solid #ccc;">{{ m.revenue }}</td>
            <td style="padding: 10px; border: 1px solid #ccc;">{{ m.category }}</td>
            <td style="padding: 10px; border: 1px solid #ccc;">{{ m.distributor }}</td>
        </tr>
        {% endfor %}
    </tbody>
</table>

{% endblock %}
